REM Z80 DISASSEMBLER, BY BART BOZON

10 PRINT"Z80-DISASSEMBLER BY BART BOZON"
11 MDUMP=0:LOLI=0:GROOT=15
20 PRINT"choose: 0)list 1)memdump + list 2)memdump 3)longlist ";
25 INPUT"4)stop:";ANSWER$
30 IF ANSWERS$="0" THEN MDUMP=0
31 IF ANSWERS$="1" THEN MDUMP=1
32 IF ANSWERS$="2" THEN GOTO 200
33 IF ANSWERS$="3" THEN MDUMP=0:LOLI=2
34 IF ANSWERS$="4" THEN STOP
50 INPUT"choose start adress:";ADRS
99 FL=0
100 FOR I=ADRS  TO ADRS+GROOT 
101 IF (((I-ADRS) AND &H0F) =0) AND (MDUMP=1) THEN GOSUB 3500
105 IF FL=2 THEN PHEX=PEEK(I-2): FL = 1: PRINT "     ";:GOSUB 3100:PRINT
106 IF FL=1 THEN PHEX=PEEK(I-1): PRINT "     ";:GOSUB 3100:PRINT
110  RES=PEEK(I):FL=0
120  PHEX=(I AND &hFF00)/256: GOSUB 3100: PHEX=I AND &hFF: GOSUB 3100
130 PRINT" ";: PHEX=RES: GOSUB 3100:PRINT" ";

REM DIVISION IN ROWS -> GOSUBS

140  ON INT(RES/64)+1 GOSUB 1000,1400,1800,2000
170  PRINT
180 NEXT I
190 ADRS=I: IF LOLI=2 GOTO 100
195 GOTO 20
200 GOSUB 3500 
210 I=I+&HC0:PRINT "ADRESS ";HEX$(I):GOTO 200
220 GOTO 20

REM FIRST 4 ROWS

1000 ON (RES AND &H0F)+1 GOSUB 1050,1060,1070,1080,1090,1100,1110
1010 IF (RES AND &H0F)+1 <8 GOTO 1045
1020 ON (RES AND &H0F)-6 GOSUB 1120,1130,1140,1150,1160,1170,1180
1030 IF (RES AND &H0F)+1 <15 GOTO 1045
1040 ON (RES AND &H0F)-13 GOSUB 1190,1200
1045 RETURN

REM FIRST 4 ROWS - DIVIDED BY COLUM (1050-> 1200)

1050 ON (RES AND &HF0)/16+1 GOSUB 1052,1053,1054,1055
1051 RETURN
1052 PRINT "NOP";:RETURN
1053 PRINT "DJNZ 0";:GOTO 1056
1054 PRINT "JR NZ,0";:GOTO 1056
1055 PRINT "JR NC,0";:GOTO 1056
1056 I=I+1: FL =FL +1:PHEX=PEEK(I):GOSUB 3100: RETURN
1060 PRINT "LD ";:ON (RES AND &HF0)/16+1 GOSUB 3300,3310,3320,3330
1061 PRINT ",0";

REM PRINTEN VAN DUBBEL GETAL

1062 I=I+1:PHEX=PEEK(I):GOSUB 3100:I=I+1:PHEX=PEEK(I):FL =FL+2
1063 GOSUB 3100:RETURN

1070 ON (RES AND &HF0)/16+1 GOSUB 1072,1073,1074,1075
1071 RETURN
1072 PRINT "LD (BC),A";:RETURN
1073 PRINT "LD (DE),A";:RETURN
1074 PRINT "LD (0";:GOSUB 1062:PRINT "),HL";:RETURN
1075 PRINT "LD (0";:GOSUB 1062:PRINT "),A";:RETURN
1080 PRINT "INC ";:GOTO 1181
1090 PRINT "INC ";:ON (RES AND &HF0)/16+1 GOSUB 3000,3020,3040,3060
1091 RETURN
1100 PRINT "DEC ";:ON (RES AND &HF0)/16+1 GOSUB 3000,3020,3040,3060
1101 RETURN
1110 PRINT "LD ";:ON (RES AND &HF0)/16+1 GOSUB 3000,3020,3040,3060
1111 PRINT ",0";:I=I+1:FL =FL +1:PHEX=PEEK(I):GOSUB 3100: RETURN
1120 ON (RES AND &HF0)/16+1 GOSUB 1121,1122,1123,1124:RETURN
1121 PRINT "RLCA";:RETURN
1122 PRINT "RLA";:RETURN
1123 PRINT "DAA";:RETURN
1124 PRINT "SCF";:RETURN
1130 ON (RES AND &HF0)/16+1 GOSUB 1132,1133,1134,1135
1131 RETURN
1132 PRINT "EX AF,AF'";:RETURN
1133 PRINT "JR 0";:GOTO 1136
1134 PRINT "JR Z,0";:GOTO 1136
1135 PRINT "JR C,0";:GOTO 1136
1136 I=I+1:FL =FL +1:PHEX=PEEK(I):GOSUB 3100: RETURN
1140 PRINT "ADD HL,";:GOTO 1181
1150 ON (RES AND &HF0)/16+1 GOSUB 1152,1153,1154,1155
1151 RETURN
1152 PRINT "LD A,(BC)";:RETURN
1153 PRINT "LD A,(DE)";:RETURN
1154 PRINT "LD HL,(0";:GOSUB 1062:PRINT ")";:RETURN
1155 PRINT "LD A,(0";:GOSUB 1062:PRINT ")";:RETURN
1160 PRINT "DEC ";:GOTO 1181
1170 PRINT "INC ";:GOTO 1182
1180 PRINT "DEC ";:GOTO 1182
1181 ON (RES AND &HF0)/16+1 GOSUB 3300,3310,3320,3330:RETURN
1182 ON (RES AND &HF0)/16+1 GOSUB 3200,3210,3220,3230:RETURN
1190 PRINT "LD ";:ON (RES AND &HF0)/16+1 GOSUB 3200,3210,3220,3230
1191 PRINT ",0";:I=I+1:FL =FL +1:PHEX=PEEK(I):GOSUB 3100: RETURN
1200 ON (RES AND &HF0)/16+1 GOSUB 1201,1202,1203,1204:RETURN
1201 PRINT "RRCA";:RETURN
1202 PRINT "RRA";:RETURN
1203 PRINT "CPL";:RETURN
1204 PRINT "CCF";:RETURN

REM ALL THE LD ROWS (4-7)

1400 RES=RES-64:PRINT "LD ";
1410 ON (INT(RES /8)+1) GOSUB 3000,3010,3020,3030,3040,3050,3060,3070
1420 PRINT ",";
1430 ON (RES AND 7)+1 GOSUB 3000,3010,3020,3030,3040,3050,3060,3070 
1440 RETURN

REM ALL THE ADD/XOR/AND ROWS (8-11)

1800 RES=RES-128
1810 ON (INT(RES /8)+1) GOSUB 1840,1850,1860,1870,1880,1890,1900,1910
1820 ON (RES AND 7)+1 GOSUB 3000,3010,3020,3030,3040,3050,3060,3070 
1830 RETURN
1840 PRINT "ADD ";:RETURN
1850 PRINT "ADC A,";:RETURN
1860 PRINT "SUB ";:RETURN
1870 PRINT "SBC A,";:RETURN
1880 PRINT "AND ";:RETURN
1890 PRINT "XOR ";:RETURN
1900 PRINT "OR ";:RETURN
1910 PRINT "CP ";:RETURN
1920 RETURN

REM ROWS (12-16)

2000 RES=RES-192
2005 ON (RES AND &H0F)+1 GOSUB 2050,2060,2070,2080,2090,2100,2110
2010 IF (RES AND &H0F)+1 <8 GOTO 2045
2020 ON (RES AND &H0F)-6 GOSUB 2120,2130,2140,2150,2160,2170,2180
2030 IF (RES AND &H0F)+1 <15 GOTO 2045
2040 ON (RES AND &H0F)-13 GOSUB 2190,2200
2045 RETURN

REM 12-16 ROWS - DIVIDED BY COLUM (2050-> 2200)

2050 PRINT "RET ";:ON (RES AND &HF0)/16+1 GOSUB 3400,3410,3420,3430
2051 RETURN
2060 PRINT "POP ";:ON (RES AND &HF0)/16+1 GOSUB 3300,3310,3320,3335
2061 RETURN
2070 PRINT "JP ";:ON (RES AND &HF0)/16+1 GOSUB 3400,3410,3420,3430
2071 PRINT ",0";:GOSUB 1062:RETURN

2080 ON (RES AND &HF0)/16+1 GOSUB 2082,2083,2085,2086
2081 RETURN
2082 PRINT "JP 0";:GOSUB 1062:RETURN
2083 PRINT "OUT (0";:I=I+1: FL =FL +1:PHEX=PEEK(I):GOSUB 3100
2084 PRINT "),A";:RETURN
2085 PRINT "EX (SP),HL";:RETURN
2086 PRINT "DI";:RETURN
2090 PRINT "CALL ";:ON (RES AND &HF0)/16+1 GOSUB 3400,3410,3420,3430
2091 PRINT ",0";
2092 GOSUB 1062:RETURN
2100 PRINT "PUSH ";:ON (RES AND &HF0)/16+1 GOSUB 3300,3310,3320,3335
2101 RETURN
2110 ON (RES AND &HF0)/16+1 GOSUB 2111,2112,2113,2114:RETURN
2111 PRINT "ADD A,0";:GOTO 1136
2112 PRINT "SUB 0";:GOTO 1136
2113 PRINT "AND 0";:GOTO 1136
2114 PRINT "OR 0";:GOTO 1136
2120 ON (RES AND &HF0)/16+1 GOSUB 2121,2122,2123,2124:RETURN
2121 PRINT "RST 00H";: RETURN
2122 PRINT "RST 10H";: RETURN
2123 PRINT "RST 20H";: RETURN
2124 PRINT "RST 30H";: RETURN
2130 PRINT "RET ";:ON (RES AND &HF0)/16+1 GOSUB 3600,3610,3620,3630
2131 RETURN
2140 ON (RES AND &HF0)/16+1 GOSUB 2141,2142,2143,2144:RETURN
2141 PRINT "RET";: RETURN
2142 PRINT "EXX";: RETURN
2143 PRINT "JP (HL)";: RETURN
2144 PRINT "LS SP,HL";: RETURN
2150 PRINT "JP ";:ON (RES AND &HF0)/16+1 GOSUB 3600,3610,3620,3630
2151 PRINT ",0";:GOSUB 1062:RETURN
2160 ON (RES AND &HF0)/16+1 GOSUB 2161,2162,2163,2164:RETURN
2161 PRINT "1 BIT INSTRUCTIONS 0";:GOTO 1136
2162 PRINT "SUB 0";:GOTO 1136
2163 PRINT "EX DE,HL";:RETURN
2164 PRINT "EI";:RETURN
2170 PRINT "CALL ";:ON (RES AND &HF0)/16+1 GOSUB 3600,3610,3620,3630
2171 PRINT ",0";
2172 GOSUB 1062:RETURN
2180 ON (RES AND &HF0)/16+1 GOSUB 2181,2182,2183,2184:RETURN
2181 PRINT "CALL 0";:GOSUB 1062: RETURN
2182 PRINT "IX COMMANDS 0";: GOTO 1136
2183 PRINT "EXTD COMMANDS 0";:GOTO 1136
2184 PRINT "IY COMMANDS 0";:GOTO 1136
2190 ON (RES AND &HF0)/16+1 GOSUB 2191,2192,2193,2194:RETURN
2191 PRINT "ADC A,0";:GOTO 1136
2192 PRINT "SBC A,0";:GOTO 1136
2193 PRINT "XOR 0";:GOTO 1136
2194 PRINT "CP 0";:GOTO 1136
2200 ON (RES AND &HF0)/16+1 GOSUB 2201,2202,2203,2204:RETURN
2201 PRINT "RST 08H";: RETURN
2202 PRINT "RST 18H";: RETURN
2203 PRINT "RST 28H";: RETURN
2204 PRINT "RST 38H";: RETURN

REM SUBROUTINES

3000 PRINT "B";:RETURN
3010 PRINT "C";:RETURN
3020 PRINT "D";:RETURN
3030 PRINT "E";:RETURN
3040 PRINT "H";:RETURN
3050 PRINT "L";:RETURN
3060 PRINT "(HL)";:RETURN
3070 PRINT "A";:RETURN
3100 IF (PHEX AND &HF0)<10 THEN PRINT"0";
3110 PRINT HEX$(PHEX);:RETURN
3200 PRINT "C";:RETURN
3210 PRINT "E";:RETURN
3220 PRINT "L";:RETURN
3230 PRINT "A";:RETURN
3300 PRINT "BC";:RETURN
3310 PRINT "DE";:RETURN
3320 PRINT "HL";:RETURN
3330 PRINT "SP";:RETURN
3335 PRINT "AF";:RETURN
3400 PRINT "NZ";:RETURN
3410 PRINT "NC";:RETURN
3420 PRINT "PO";:RETURN
3430 PRINT "P";:RETURN
3500 FOR J=0 TO &HBF 
3510 PRES=PEEK(I+J)
3520 IF (PRES<32) OR (PRES=127) THEN PRINT CHR$(247); : GOTO 3530
3525 PRINT CHR$(PRES); 
3530 IF (J AND &H1F)=&H1F THEN PRINT
3540 NEXT J
3550 PRINT:RETURN
3600 PRINT "Z";:RETURN
3610 PRINT "C";:RETURN
3620 PRINT "PE";:RETURN
3630 PRINT "M";:RETURN
